<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A recipes Extension for Persistent Homology and Its Vectorizations • tdarec</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A recipes Extension for Persistent Homology and Its Vectorizations">
<meta property="og:description" content="Topological data analytic methods in machine learning rely on vectorizations of the persistence diagrams that encode persistent homology, as surveyed by Ali &amp;al (2000) &lt;doi:10.48550/arXiv.2212.09703&gt;. Persistent homology can be computed using TDA and ripserr and vectorized using TDAvec. The Tidymodels package collection modularizes machine learning in R for straightforward extensibility; see Kuhn &amp; Silge (2022, ISBN:978-1-4920-9644-3). These recipe steps and dials tuners make efficient algorithms for computing and vectorizing persistence diagrams available for Tidymodels workflows.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tdarec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/hyperparameter-tuning.html">Tuning persistent homological hyperparameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tdaverse/tdarec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="tdarec">tdarec<a class="anchor" aria-label="anchor" href="#tdarec"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of {tdarec} is to provide <a href="https://cran.r-project.org/package=recipes" class="external-link">{recipes}</a>-style preprocessing steps to compute persistent homology (PH) and calculate vectorizations of persistence diagrams (PDs), and to provide <a href="https://cran.r-project.org/package=dials" class="external-link">{dials}</a>-style hyperparameter tuners to optimize these steps in ML workflows.</p>
<p>You can install the development version of tdarec from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"tdaverse/tdarec"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="design">Design<a class="anchor" aria-label="anchor" href="#design"></a>
</h2>
<div class="section level3">
<h3 id="recipe-steps">Recipe steps<a class="anchor" aria-label="anchor" href="#recipe-steps"></a>
</h3>
<p>The current version provides two engines to compute PH (more will be implemented; see <a href="https://github.com/tdaverse/tdarec/issues/2" class="external-link">this issue</a> for plans):</p>
<ul>
<li>
<strong>Vietoris–Rips</strong> filtrations of point clouds (distance matrices or coordinate matrices) using <a href="https://github.com/tdaverse/ripserr" class="external-link">{ripserr}</a>
</li>
<li>
<strong>cubical</strong> filtrations of rasters (pixelated or voxelated data) using {ripserr}</li>
</ul>
<p>Also included are a pre-processing step to introduce <strong>Gaussian blur</strong> to rasters and a post-processing step to select PDs for <strong>specific homological degrees</strong>.</p>
<p>Finally, this version provides steps that deploy the highly efficient <strong>vectorizations</strong> implemented in <a href="https://github.com/uislambekov/TDAvec" class="external-link">{TDAvec}</a>. These were written with {Rcpp} specifically for ML applications.</p>
</div>
<div class="section level3">
<h3 id="tunable-parameters">Tunable parameters<a class="anchor" aria-label="anchor" href="#tunable-parameters"></a>
</h3>
<p>Most steps come with new tunable parameters, for example the maximum homological degree of the VR filtration and the number of levels in persistence landscapes.</p>
<p>One set of parameters that are conspicuously untunable are the “scale sequences”—the values at (or intervals over) which each transformed PD is vectorized. An implementation is underway.</p>
</div>
<div class="section level3">
<h3 id="data-formats-and-sets">Data formats and sets<a class="anchor" aria-label="anchor" href="#data-formats-and-sets"></a>
</h3>
<p>While the most common {recipes} are designed for structured tabular data, i.e. columns with numeric or categorical entries, almost all data subjected to machine learning with persistent homology has been in forms like point clouds or greyscale images that must be stored in list-columns. All {tdarec} examples use data in this form, and the data installed with the package is pre-processed for such use.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This example uses existing engines to optimize a simple classification model for point clouds sampled from different embeddings of the Klein bottle. Note also that <a href="https://cran.r-project.org/package=glmnet" class="external-link">{glmnet}</a> and <a href="https://cran.r-project.org/package=tdaunif" class="external-link">{tdaunif}</a> must be installed.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>While not required, we attach Tidyverse and Tidymodels for convenience (with messages suppressed):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare a Tidymodels session and attach {tdarec}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tdaverse/tdarec" class="external-link">tdarec</a></span><span class="op">)</span></span></code></pre></div>
<p>The points are sampled uniformly from one of two Klein bottle embeddings, determined by a coin toss between the flat and the tube.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate samples from two embeddings</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20024L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>embedding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flat"</span>, <span class="st">"tube"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">48</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">embedding</span>, <span class="kw">function</span><span class="op">(</span><span class="va">emb</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span></span>
<span>      <span class="va">emb</span>,</span>
<span>      flat <span class="op">=</span> <span class="fu">tdaunif</span><span class="fu">::</span><span class="fu"><a href="https://tdaverse.github.io/tdaunif/reference/klein-bottles.html" class="external-link">sample_klein_flat</a></span><span class="op">(</span><span class="fl">60</span>, sd <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>,</span>
<span>      tube <span class="op">=</span> <span class="fu">tdaunif</span><span class="fu">::</span><span class="fu"><a href="https://tdaverse.github.io/tdaunif/reference/klein-bottles.html" class="external-link">sample_klein_tube</a></span><span class="op">(</span><span class="fl">60</span>, sd <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>embedding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">klein_data</span></span>
<span><span class="co">#&gt; # A tibble: 48 × 2</span></span>
<span><span class="co">#&gt;    embedding sample        </span></span>
<span><span class="co">#&gt;    &lt;fct&gt;     &lt;list&gt;        </span></span>
<span><span class="co">#&gt;  1 tube      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  2 tube      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  3 flat      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  4 flat      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  5 flat      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  6 flat      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  7 tube      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  8 tube      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt;  9 tube      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt; 10 flat      &lt;dbl [60 × 4]&gt;</span></span>
<span><span class="co">#&gt; # ℹ 38 more rows</span></span></code></pre></div>
<p>We apply a classical partition into 80% training and 20% testing sets and prepare to perform 3-fold cross-validation on the training set.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># partition the data</span></span>
<span><span class="va">klein_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">klein_data</span>, prop <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span></span>
<span><span class="va">klein_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">klein_split</span><span class="op">)</span></span>
<span><span class="va">klein_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">klein_split</span><span class="op">)</span></span>
<span><span class="va">klein_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">klein_train</span>, v <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span></code></pre></div>
<p>In this example, we adopt a common transformation of persistence diagrams, Euler characteristic curves. For their vectorization, we need a scale sequence that spans the birth and death times of any persistent features, and for this we choose a round number larger than the diameters of both point clouds (based on the sampler documentation) as an upper bound. Rather than choose <em>a priori</em> to use homology up to degree 0, 1, 2, or 3, we prepare to tune the maximum degree during optimization.</p>
</div>
<div class="section level3">
<h3 id="specifications">Specifications<a class="anchor" aria-label="anchor" href="#specifications"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify a pre-processing recipe</span></span>
<span><span class="va">scale_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">embedding</span> <span class="op">~</span> <span class="va">sample</span>, data <span class="op">=</span> <span class="va">klein_train</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/step_pd_point_cloud.html">step_pd_point_cloud</a></span><span class="op">(</span></span>
<span>    <span class="va">sample</span>, max_hom_degree <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="st">"vr_degree"</span><span class="op">)</span>,</span>
<span>    keep_original_cols <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/step_vpd_euler_characteristic_curve.html">step_vpd_euler_characteristic_curve</a></span><span class="op">(</span></span>
<span>    <span class="va">sample_pd</span>, xseq <span class="op">=</span> <span class="va">scale_seq</span>,</span>
<span>    keep_original_cols <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">klein_rec</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Recipe ──────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; outcome:   1</span></span>
<span><span class="co">#&gt; predictor: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; • persistent features from a Rips filtration of: sample</span></span>
<span><span class="co">#&gt; • Euler characteristic curve of: sample_pd</span></span></code></pre></div>
<p>For simplicity, we choose a common model for ML classification, penalized logistic regression. We fix the mixture coefficient to use LASSO rather than ridge regression but prepare the penalty parameter for tuning.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify a classification model</span></span>
<span><span class="fu">logistic_reg</span><span class="op">(</span>penalty <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, mixture <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glmnet"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">klein_lm</span></span>
<span><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Main Arguments:</span></span>
<span><span class="co">#&gt;   penalty = tune()</span></span>
<span><span class="co">#&gt;   mixture = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computational engine: glmnet</span></span></code></pre></div>
<p>We then generate a complete hyperparameter tuning grid by crossing the grids generated for the two unspecified parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate a hyperparameter tuning grid</span></span>
<span><span class="va">klein_rec_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/grid_regular.html" class="external-link">grid_regular</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">klein_rec</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vr_degree</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">klein_lm_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dials.tidymodels.org/reference/grid_regular.html" class="external-link">grid_regular</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">klein_lm</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="va">klein_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">klein_rec_grid</span>, <span class="va">klein_lm_grid</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimization">Optimization<a class="anchor" aria-label="anchor" href="#optimization"></a>
</h3>
<p>We evaluate the model across the hyperparameter grid using cross-validation, using the area under the sensitivity–specificity (ROC) curve:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># optimize the model performance</span></span>
<span><span class="va">klein_res</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  <span class="va">klein_lm</span>,</span>
<span>  preprocessor <span class="op">=</span> <span class="va">klein_rec</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">klein_folds</span>,</span>
<span>  grid <span class="op">=</span> <span class="va">klein_grid</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">roc_auc</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>From the results, we obtain the best-performing parameter setting:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">klein_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select_best</span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"roc_auc"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">klein_best</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;        penalty vr_degree .config             </span></span>
<span><span class="co">#&gt;          &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;               </span></span>
<span><span class="co">#&gt; 1 0.0000000001         1 Preprocessor1_Model1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluation">Evaluation<a class="anchor" aria-label="anchor" href="#evaluation"></a>
</h3>
<p>This optimal setting includes both the VR homology degree and the GLM penalty, so both the pre-processing recipe and the predictive model must be finalized in order to fit the final model to the full training set:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">klein_rec_fin</span> <span class="op">&lt;-</span> <span class="va">klein_rec</span> <span class="op">|&gt;</span> <span class="fu">finalize_recipe</span><span class="op">(</span><span class="va">klein_best</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">klein_lm_fin</span> <span class="op">&lt;-</span> <span class="va">klein_lm</span> <span class="op">|&gt;</span> <span class="fu">finalize_model</span><span class="op">(</span><span class="va">klein_best</span><span class="op">)</span></span>
<span><span class="va">klein_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span></span>
<span>  <span class="va">klein_lm_fin</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">klein_rec_fin</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">klein_rec_fin</span>, new_data <span class="op">=</span> <span class="va">klein_train</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we evaluate the fitted model on the testing set:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">klein_fit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>    new_data <span class="op">=</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">klein_rec_fin</span>, new_data <span class="op">=</span> <span class="va">klein_test</span><span class="op">)</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"prob"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">klein_test</span>, <span class="va">embedding</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">embedding</span>, <span class="va">.pred_flat</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 roc_auc binary          0.92</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="contributions">Contributions<a class="anchor" aria-label="anchor" href="#contributions"></a>
</h2>
<p>Please note that the tdarec project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
<div class="section level3">
<h3 id="generated-code">Generated code<a class="anchor" aria-label="anchor" href="#generated-code"></a>
</h3>
<p>Much of the code exposing {TDAvec} tools to Tidymodels is generated by elaborate scripts rather than written manually. While maintenance of these scripts takes effort, it prevents (or at least flags) errors arising from cascading implications of changes to the original functions, and it allows simple and rapid package-wide adjustments. If you see an issue with generated code, please raise an issue to discuss it before submitting a pull request.</p>
</div>
<div class="section level3">
<h3 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h3>
<p>This project was funded by <a href="https://r-consortium.org/all-projects/2024-group-1.html#modular-interoperable-and-extensible-topological-data-analysis-in-r" class="external-link">an ISC grant from the R Consortium</a> and done in coordination with Aymeric Stamm and with guidance from Bertrand Michel and Paul Rosen. It builds upon the work of and conversations with Umar Islambekov and Aleksei Luchinsky, authors of <a href="https://github.com/uislambekov/TDAvec" class="external-link">{TDAvec}</a>. Package development also benefitted from the support of colleagues in <a href="https://systemsmedicine.pulmonary.medicine.ufl.edu/" class="external-link">the Laboratory for Systems Medicine</a> and <a href="https://tda.math.ufl.edu/" class="external-link">the TDA Seminar</a> and the use of equipment at <a href="https://www.ufl.edu/" class="external-link">the University of Florida</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/tdaverse/tdarec/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/tdaverse/tdarec/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tdarec</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jason Cory Brunson <br><small class="roles"> Maintainer, author </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=tdarec" class="external-link"><img src="https://www.r-pkg.org/badges/version/tdarec" alt="CRAN status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Jason Cory Brunson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer>
</div>






  </body>
</html>
